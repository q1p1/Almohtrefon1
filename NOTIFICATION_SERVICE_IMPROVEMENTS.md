# ุชุญุณููุงุช ุฎุฏูุฉ ุงูุฅุดุนุงุฑุงุช (NotificationService)

## ุงููุดุงูู ุงูุชู ุชู ุญููุง โ

### 1. **ุฏุนู ุนุฏุฉ ูุณุชูุนูู ูููุณ ุงูููุน**

- **ุงููุดููุฉ ุงูุณุงุจูุฉ**: `Map<string, (data)=>void>` - ูุณุชูุน ูุงุญุฏ ููุท ููู ููุน
- **ุงูุญู**: `Map<NotificationType, Set<NotificationListener>>` - ุนุฏุฉ ูุณุชูุนูู ููู ููุน
- **ุงูููุงุฆุฏ**: ูููู ูุนุฏุฉ ููููุงุช ุงูุงุณุชูุงุน ูููุณ ููุน ุงูุฅุดุนุงุฑ

### 2. **ุงูุชุญูู ูู ุจููุฉ ุงูุฑุณุงูุฉ**

- **ุงููุดููุฉ ุงูุณุงุจูุฉ**: ุฃู ุชุจููุจ ููููู ุฅุฑุณุงู `{type,data}` ุจุฃู ุดูู
- **ุงูุญู**:
  - `NotificationType` enum ููุฃููุงุน ุงููุณููุญุฉ
  - `isValidMessage()` ููุชุญูู ูู ุตุญุฉ ุงูุฑุณุงูุฉ
  - ุฃููุงุน TypeScript ูุญุฏุฏุฉ ููุจูุงูุงุช
- **ุงูููุงุฆุฏ**: ููุน ุงูุฃุฎุทุงุก ูุชุญุณูู ุงูุฃูุงู

### 3. **ุงูุชูุฑูู ุจูู ุงููุฑุณู ูุงููุณุชูุจู**

- **ุงููุดููุฉ ุงูุณุงุจูุฉ**: ูุง ููุฌุฏ ุชูููุฒ ุจูู ุงููุฑุณู ูุงููุณุชูุจู
- **ุงูุญู**:
  - `senderId` ูุฑูุฏ ููู ุชุจููุจ
  - ุชุฌุงูู ุงูุฑุณุงุฆู ูู ููุณ ุงููุฑุณู
- **ุงูููุงุฆุฏ**: ููุน ุงูุฅุดุนุงุฑุงุช ุงูููุฑุฑุฉ ูููุณ ุงููุฑุณู

### 4. **ุฏุนู SSR ูุจูุฆุงุช ูุง ุชุฏุนู BroadcastChannel**

- **ุงููุดููุฉ ุงูุณุงุจูุฉ**: ูุง ูุนูู ูู SSR ุฃู ูุชุตูุญุงุช ูุฏููุฉ
- **ุงูุญู**:
  - `checkBroadcastChannelSupport()` ููุชุญูู ูู ุงูุฏุนู
  - localStorage events ูู fallback
  - `initializeFallback()` ููุจูุฆุงุช ุบูุฑ ุงููุฏุนููุฉ
- **ุงูููุงุฆุฏ**: ูุนูู ูู ุฌููุน ุงูุจูุฆุงุช

### 5. **ุฅุฒุงูุฉ ุฃููุงุน `any`**

- **ุงููุดููุฉ ุงูุณุงุจูุฉ**: ุงุณุชุฎุฏุงู `any` ูุฎูู ุฃุฎุทุงุก ุงูุชุทููุฑ
- **ุงูุญู**:
  - `IncidentData` interface ููุจูุงุบุงุช
  - `SupportRequestData` interface ูุทูุจุงุช ุงูุฏุนู
  - `NotificationMessage` interface ููุฑุณุงุฆู
- **ุงูููุงุฆุฏ**: ุฃูุงู ุงูููุน (type safety) ูุชุญุณูู IDE

### 6. **ุงูุญูุงูุฉ ูู ุงูุฑุณุงุฆู ุงูุบุฑูุจุฉ**

- **ุงููุดููุฉ ุงูุณุงุจูุฉ**: ูุง ุชูุฌุฏ ุญูุงูุฉ ูู ุฑุณุงุฆู ุบุฑูุจุฉ
- **ุงูุญู**:
  - `try/catch` ุญูู `postMessage`
  - ููุชุฑุฉ ุงูุฑุณุงุฆู ูู `onmessage`
  - `isValidMessage()` ููุชุญูู ูู ุตุญุฉ ุงูุจูุงูุงุช
- **ุงูููุงุฆุฏ**: ุงุณุชูุฑุงุฑ ุงูุชุทุจูู ูููุน ุงูุฃุฎุทุงุก

### 7. **ุชุญุณูู ูุตูุต ุงูุชูุณุช**

- **ุงููุดููุฉ ุงูุณุงุจูุฉ**: ูุตูุต ุบูุฑ ุฑุณููุฉ ("ูุง ูุญุด!")
- **ุงูุญู**: ูุตูุต ุฑุณููุฉ ูููููุฉ
- **ุงูููุงุฆุฏ**: ูุธูุฑ ุฃูุซุฑ ุงุญุชุฑุงููุฉ

## ุงูููุฒุงุช ุงูุฌุฏูุฏุฉ ๐

### 1. **ุฅุฏุงุฑุฉ ุงููุณุชูุนูู**

```typescript
// ุงูุญุตูู ุนูู ุนุฏุฏ ุงููุณุชูุนูู
const count = notificationService.getListenerCount(
  NotificationType.NEW_APPROVED_INCIDENT
);

// ุงูุญุตูู ุนูู ุงูุฃููุงุน ุงููุดุทุฉ
const activeTypes = notificationService.getActiveTypes();
```

### 2. **ูุฑุงูุจุฉ ุตุญุฉ ุงูุฎุฏูุฉ**

```typescript
// ุงูุชุญูู ูู ุญุงูุฉ ุงูุฎุฏูุฉ
const isHealthy = notificationService.isHealthy();
```

### 3. **ุฏุนู Fallback ุชููุงุฆู**

- ูุชุญูู ุชููุงุฆูุงู ุฅูู localStorage events ุนูุฏ ุนุฏู ุชููุฑ BroadcastChannel
- ูุง ูุญุชุงุฌ ุชุฏุฎู ูู ุงููุทูุฑ

### 4. **ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก ุงููุญุณูุฉ**

- `try/catch` ูู ุฌููุน ุงูุนูููุงุช
- ุชุณุฌูู ุงูุฃุฎุทุงุก ูู console
- ุงุณุชูุฑุงุฑ ุงูุนูู ุญุชู ุนูุฏ ุญุฏูุซ ุฃุฎุทุงุก

## ุงูุงุณุชุฎุฏุงู

### ุงูุงุณุชูุงุน ููุฅุดุนุงุฑุงุช

```typescript
// ุนุฏุฉ ูุณุชูุนูู ูููุณ ุงูููุน
const unsubscribe1 = notificationService.listen(
  NotificationType.NEW_APPROVED_INCIDENT,
  (data) => console.log("ุงููุณุชูุน 1:", data)
);

const unsubscribe2 = notificationService.listen(
  NotificationType.NEW_APPROVED_INCIDENT,
  (data) => console.log("ุงููุณุชูุน 2:", data)
);

// ุฅูุบุงุก ุงูุงุณุชูุงุน
unsubscribe1();
unsubscribe2();
```

### ุฅุฑุณุงู ุงูุฅุดุนุงุฑุงุช

```typescript
// ุฅุฑุณุงู ุจูุงุบ ุฌุฏูุฏ
notificationService.notifyNewApprovedIncident({
  id: "incident_123",
  reporterName: "ุฃุญูุฏ ูุญูุฏ",
  reporterPhone: "0501234567",
  status: "approved",
  // ... ุจุงูู ุงูุจูุงูุงุช
});

// ุฅุฑุณุงู ุทูุจ ุฏุนู
notificationService.notifyNewSupportRequest({
  id: "sr_456",
  incidentId: "incident_123",
  volunteerId: "volunteer_789",
  note: "ุฃุญุชุงุฌ ูุณุงุนุฏุฉ ุฅุถุงููุฉ",
  status: "pending",
  createdAt: new Date().toISOString(),
});
```

## ุงูุชูุงูู ูุน ุงูุฅุตุฏุงุฑ ุงูุณุงุจู

ุงูุฎุฏูุฉ ุงูุฌุฏูุฏุฉ ูุชูุงููุฉ ุชูุงูุงู ูุน ุงูููุฏ ุงูููุฌูุฏ. ูุง ุญุงุฌุฉ ูุชุบููุฑ ุฃู ุดูุก ูู ุงููููุงุช ุงูุชู ุชุณุชุฎุฏู ุงูุฎุฏูุฉ.

## ุงูุฃุฏุงุก

- **ุฐุงูุฑุฉ ุฃูู**: ุงุณุชุฎุฏุงู `Set` ุจุฏูุงู ูู `Map` ูููุณุชูุนูู
- **ุฃุฏุงุก ุฃูุถู**: ููุชุฑุฉ ุงูุฑุณุงุฆู ูุจู ุงููุนุงูุฌุฉ
- **ุงุณุชูุฑุงุฑ ุฃุนูู**: ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก ูู ุฌููุน ุงูุนูููุงุช
- **ุชูุงูู ุฃูุณุน**: ูุนูู ูู ุฌููุน ุงูุจูุฆุงุช ูุงููุชุตูุญุงุช
